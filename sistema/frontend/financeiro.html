<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Financeiro - Gestão Eventos</title>
<style>
body{background:#0f1724;color:#e6eef8;font-family:Arial;padding:20px;}
.container{max-width:900px;margin:0 auto;}
.card{background:#0b1220;padding:16px;border-radius:8px;margin-bottom:12px;}
input,button,select{padding:8px;margin:6px 0;border-radius:6px;border:1px solid #263241;background:#071023;color:#fff;}
button{background:#16a34a;border:none;color:#fff;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{padding:8px;border-bottom:1px solid #21303a;text-align:left;}
</style>
</head>
<body>
<div class="container">
  <h1>Financeiro</h1>
  <div class="card">
    <h3>Criar Pedido</h3>
    <input id="cliente_id" placeholder="ID do cliente (ex: 1)"/>
    <input id="descricao" placeholder="Descrição"/>
    <input id="valor" placeholder="Valor"/>
    <button onclick="criarPedido()">Criar Pedido</button>
  </div>

  <div class="card">
    <h3>Gerar Fatura</h3>
    <input id="pedido_id" placeholder="ID do pedido"/>
    <input id="valor_total" placeholder="Valor total"/>
    <input id="vencimento" placeholder="Data vencimento (YYYY-MM-DD)"/>
    <button onclick="gerarFatura()">Gerar Fatura</button>
  </div>

  <div class="card">
    <h3>Registrar Pagamento</h3>
    <input id="fatura_id" placeholder="ID da fatura"/>
    <input id="valor_pago" placeholder="Valor Pago"/>
    <select id="forma"><option value="">Forma pagamento</option><option value="1">Cartão</option><option value="2">Pix</option><option value="3">Boleto</option></select>
    <input id="comprovante" type="file"/>
    <button onclick="registrarPagamento()">Registrar Pagamento</button>
  </div>

  <div class="card">
    <h3>Listar Faturas</h3>
    <button onclick="listarFaturas()">Listar</button>
    <div id="lista"></div>
  </div>
</div>
<script>
async function criarPedido(){
  const cliente_id = document.getElementById('cliente_id').value;
  const descricao = document.getElementById('descricao').value;
  const valor = parseFloat(document.getElementById('valor').value);
  const res = await fetch('/api/pedidos', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({cliente_id,descricao,valor})});
  alert((await res.json()).id ? 'Pedido criado' : JSON.stringify(await res.json()));
}

async function gerarFatura(){
  const pedido_id = document.getElementById('pedido_id').value;
  const valor_total = parseFloat(document.getElementById('valor_total').value);
  const data_vencimento = document.getElementById('vencimento').value;
  const res = await fetch('/api/faturas', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({pedido_id,valor_total,data_vencimento})});
  alert((await res.json()).id ? 'Fatura criada' : JSON.stringify(await res.json()));
}

async function registrarPagamento(){
  const fatura_id = document.getElementById('fatura_id').value;
  const valor_pago = parseFloat(document.getElementById('valor_pago').value);
  const forma_pagamento_id = document.getElementById('forma').value;
  const file = document.getElementById('comprovante').files[0];
  const fd = new FormData();
  fd.append('fatura_id', fatura_id);
  fd.append('valor_pago', valor_pago);
  fd.append('forma_pagamento_id', forma_pagamento_id);
  if(file) fd.append('comprovante', file);
  const res = await fetch('/api/pagamentos', {method:'POST', body: fd});
  alert((await res.json()).id ? 'Pagamento registrado' : JSON.stringify(await res.json()));
}

async function listarFaturas(){
  const res = await fetch('/api/faturas');
  const arr = await res.json();
  const root = document.getElementById('lista');
  if(!arr || !arr.length){ root.innerHTML='<p>Nenhuma fatura</p>'; return; }
  let html='<table><tr><th>ID</th><th>Pedido</th><th>Valor</th><th>Status</th></tr>';
  arr.forEach(f=> html+=`<tr><td>${f.id}</td><td>${f.pedido_desc}</td><td>${f.valor_total}</td><td>${f.status_pagamento}</td></tr>`);
  html+='</table>';
  root.innerHTML=html;
}
</script>
</body>
</html>

